<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh sách đơn hàng của Supplier</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <div id="sidebar" class="bg-light p-3 border-end" style="width: 250px;">
      <h5 class="mb-3">Menu</h5>
      <ul class="nav flex-column">
        <li class="nav-item"><a href="index.html" class="nav-link">Trang chủ</a></li>
        <li class="nav-item"><a href="supplier.html" class="nav-link active">Đơn hàng Supplier</a></li>
        <li class="nav-item"><a href="nhapkho.html" class="nav-link">Nhập kho</a></li>
      </ul>
    </div>

    <div class="flex-grow-1 p-4">
      <h2>Danh sách đơn hàng của Supplier</h2>
      
      <table class="table table-bordered table-hover mt-3">
        <thead class="table-light">
          <tr>
            <th>POID</th>
            <th>Supplier Name</th>
            <th>Created At</th>
            <th>Status</th>
            <th>Total Lines</th>
            <th>Total Amount</th>
          </tr>
        </thead>
        <tbody id="poTableBody">
        </tbody>
      </table>
    </div>
  </div>

 <script>
  // Lấy supplierId và token từ sessionStorage hoặc localStorage
  const supplierId = sessionStorage.getItem("supplierId") 
                  || localStorage.getItem("supplierId");
  const token = sessionStorage.getItem("authToken") 
             || localStorage.getItem("authToken");

  async function loadPOs() {
    if (!supplierId || !token) {
      window.location.href = "login.html";
      return;
    }

    try {
      const res = await fetch(
        `https://localhost:7225/api/PurchaseOrders/by-supplier/${supplierId}?page=1&pageSize=20`, 
        {
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json"
          }
        }
      );

      if (res.status === 204) {
        document.getElementById("poTableBody").innerHTML =
          `<tr><td colspan="6" class="text-center text-muted">Không có đơn hàng nào</td></tr>`;
        return;
      }

      if (!res.ok) throw new Error("Lỗi khi gọi API");

      const data = await res.json();
      const tbody = document.getElementById("poTableBody");
      tbody.innerHTML = "";

      data.forEach(po => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${po.poid}</td>
          <td>${po.supplierName}</td>
          <td>${new Date(po.createdAt).toLocaleString()}</td>
          <td>${po.status}</td>
          <td>${po.totalLines}</td>
          <td>${po.totalAmount.toLocaleString('vi-VN')} VND</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error(err);
      alert("Không thể tải dữ liệu đơn hàng.");
    }
  }

  loadPOs();
</script>


</body>
</html>
